---
mode: 'agent'
description: 'アイディアファイルから仕様書更新とプラン作成を一括実行'
---

このプロンプトは、新規のアイディアファイルから、既存の `.docs/specs/requirements.md` と `.docs/specs/design.md` の更新、および実装プランファイルの作成を一括で実行します。

## 実行手順

### フェーズ 1: アイディアファイル分析と既存仕様書確認

1. **アイディア内容の抽出**
   - アイディアファイルの「概要」から実現したい機能を特定
   - 「仕様」から具体的な動作要件と技術制約を抽出
   - 問題の背景と期待する成果を明確化

2. **既存仕様書の詳細確認**
   - `.docs/specs/requirements.md` の全要件を確認
   - `.docs/specs/design.md` の全コンポーネント・アーキテクチャを確認
   - 既存の要件・設計パターンとの関係性を分析

3. **影響範囲と更新必要性の判定**
   - 新機能が既存要件で対応できるかを判定
   - 既存アーキテクチャで実現可能かを判定
   - UI/UX変更、データ構造変更の必要性を評価

### フェーズ 2: requirements.md 更新（必要な場合）

1. **新要件の追加**
   - アイディアをユーザーストーリー形式に変換
   - WHEN-THEN-SHALL形式での受け入れ基準作成
   - 適切な要件番号の割り当て（既存番号との重複回避）

2. **既存要件の調整**
   - 関連する既存要件との整合性確保
   - 矛盾する要件の修正・統合
   - 要件間の依存関係の明確化

3. **非機能要件の見直し**
   - 新機能による性能・セキュリティ要件への影響確認
   - 必要に応じて非機能要件の追加・修正

### フェーズ 3: design.md 更新（必要な場合）

1. **アーキテクチャ影響分析**
   - 既存システム構造への影響範囲を特定
   - 新機能追加後のシステム構造を設計
   - コンポーネント間の関係性の再定義

2. **コンポーネント設計の追加・修正**
   - 新規コンポーネント・クラスの詳細設計
   - 既存コンポーネントの拡張・修正設計
   - インターフェース・メソッドシグネチャの設計

3. **データ構造とUI/UX設計**
   - データモデルの追加・拡張設計
   - 画面構成・ユーザーインタラクションの設計
   - 既存UI/UXとの統合方針

### フェーズ 4: プランファイル作成

1. **基本情報の設定**
   - 作成日の記録
   - 参照アイディアファイルの明記
   - 参照・更新した仕様書セクションの明記

2. **実装手順の策定**
   - 更新された仕様書を踏まえた段階的実装計画
   - 各フェーズでの成果物と確認ポイントの設定
   - ビルド・テスト・動作確認手順の組み込み

3. **プラン分割判定と実行**
   - 実装複雑度に基づく分割判定（5ステップ基準）
   - 分割が必要な場合の分割方針決定
   - 適切なファイル名の決定と配置

4. **品質保証計画の策定**
   - requirements.md の受け入れ基準との対応確認項目
   - design.md の設計パターンとの整合性確認項目
   - 既存機能への影響確認項目

### フェーズ 5: 全体整合性確認

1. **仕様書間整合性確認**
   - requirements.md と design.md の対応関係確認
   - 各要件に対する技術実装方針の確認
   - 更新内容の一貫性確認

2. **プランファイルとの整合性確認**
   - プランが全ての更新要件をカバーしているか確認
   - 実装手順が設計内容に沿っているか確認
   - 品質保証項目が適切に設定されているか確認

## 注意事項

- 仕様書の詳細な構成要素、記述形式は `general.instructions.md` に従う
- プランファイルのテンプレートと分割指針は `general.instructions.md` を参照
- 品質保証チェックポイントは `general.instructions.md` の基準に従う
- 更新内容の影響範囲を必ず分析・文書化する
- 既存要件・設計との矛盾が発生しないよう慎重に確認する
