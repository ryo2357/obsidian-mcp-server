# 001-02 Markdown ファイル保存ツール実装

作成日時: 2025-07-31 10:00
参照アイディアファイル: `001_プロジェクトの概要.md`

## 実装する機能

Obsidian vault 内に Markdown ファイルを保存する MCP ツールを実装します。

## 機能の詳細な仕様

### save_markdown_file ツール

- ツール名: `save_markdown_file`
- 機能: vault 内の固定ディレクトリに Markdown ファイルを保存
- 保存先: 設定ファイルで指定された固定ディレクトリ
- 入力パラメータ:
  - `filename`: ファイル名（.md 拡張子は自動付与）
  - `content`: Markdown コンテンツ
- 動作:
  - vault_path/固定ディレクトリ/filename.md にファイルを作成・保存
  - 以下の場合は AI エージェントにエラーを通知:
    - 保存先ディレクトリが存在しない場合
    - 既存ファイルがある場合

### エラーハンドリング

- vault_path が設定されていない場合のエラー
- 保存先ディレクトリが存在しない場合のエラー
- 既存ファイルが存在する場合のエラー
- ファイルパスが vault 外を指している場合のセキュリティエラー
- ファイル書き込み権限エラー
- ディスク容量不足エラー

## 技術的な実装方針

### 使用クレート（追加）

- `std::fs`: ファイル操作
- `std::path`: パス操作

### モジュール構造拡張

```text
src/
├── main.rs
├── config.rs
├── mcp/
│   ├── mod.rs
│   ├── protocol.rs
│   ├── server.rs
│   └── tools/         # 新規追加
│       ├── mod.rs
│       └── save_markdown.rs
├── vault/             # 新規追加
│   ├── mod.rs
│   └── operations.rs  # vault操作の共通処理
└── error.rs
```

### 実装手順

1. vault 操作の共通モジュール実装
2. save_markdown_file ツールの実装
3. MCP サーバーへのツール登録
4. エラーハンドリングの実装
5. 動作確認とテスト

### セキュリティ考慮

- パストラバーサル攻撃の防止
- vault 外へのアクセス制限
- ファイル名の検証（危険な文字の排除）

### 動作確認方法

- save_markdown_file ツールの個別テスト
- VSCode での MCP 連携テスト
- エラーケースの確認

## 次のステップ

このプランの完了後、`001-03`でテンプレートファイル読み込みツールの実装を行います。
